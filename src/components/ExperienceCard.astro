---
import TechText from './TechText.astro';
import TechTag from './TechTag.astro';

interface Props {
  company: string;
  role: string;
  period: string;
  location?: string;
  description: string;
  achievements: string[];
  technologies: string[];
  status?: 'current' | 'completed';
  index: number;
  defaultExpanded?: boolean;
}

const { company, role, period, location, description, achievements, technologies, status = 'completed', index } = Astro.props;
const cardId = `experience-${index}`;
---

<div class="tech-card mb-6">
  <!-- Card Header - Always visible, clickable -->
  <button 
    class="w-full text-left cursor-pointer"
    onclick={`
      // Close all other experience cards
      document.querySelectorAll('[id^="experience-"]').forEach(el => {
        if (el.id !== '${cardId}') {
          el.classList.add('hidden');
          // Find and reset the icon for closed cards
          const btn = document.querySelector('[onclick*="' + el.id + '"]');
          if (btn) btn.querySelector('.expand-icon').classList.remove('rotate-90');
        }
      });
      // Toggle current card
      document.getElementById('${cardId}').classList.toggle('hidden');
      this.querySelector('.expand-icon').classList.toggle('rotate-90');
    `}
    type="button"
  >
    <div class="flex items-start justify-between gap-4">
      <div class="flex items-start gap-3 flex-1">
        <span class={`mt-1 flex-shrink-0 ${status === 'current' ? 'status-active' : 'status-inactive'}`}>●</span>
        <div class="flex-1">
          <div class="flex items-baseline gap-3 flex-wrap mb-1">
            <span class="text-text-primary font-semibold text-base">{role}</span>
            <span class="text-accent-secondary">@{company}</span>
          </div>
          <div class="flex items-center gap-3 text-sm">
            <span class="text-text-dim">{period}</span>
            {location && (
              <>
                <span class="text-text-dim">•</span>
                <span class="text-text-dim">{location}</span>
              </>
            )}
          </div>
        </div>
      </div>
      <svg 
        class="expand-icon w-5 h-5 text-accent-primary transition-transform flex-shrink-0 mt-1"
        fill="none" 
        stroke="currentColor" 
        viewBox="0 0 24 24"
      >
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
      </svg>
    </div>
  </button>

  <!-- Expandable Content -->
  <div id={cardId} class="hidden">
    <div class="mt-4 pt-4 border-t border-tech-border space-y-4">
      <!-- Description -->
      <TechText variant="body">
        {description}
      </TechText>

      <!-- Achievements -->
      {achievements && achievements.length > 0 && (
        <div class="space-y-2">
          <span class="text-text-dim text-xs uppercase tracking-wider">Key Achievements:</span>
          {achievements.map((achievement) => (
            <div class="flex items-start gap-3 text-text-secondary">
              <span class="text-accent-success flex-shrink-0 mt-1">●</span>
              <span class="leading-relaxed">{achievement}</span>
            </div>
          ))}
        </div>
      )}

      <!-- Technologies -->
      <div>
        <span class="text-text-dim text-xs uppercase tracking-wider block mb-2">Tech Stack:</span>
        <div class="flex flex-wrap gap-2">
          {technologies.map((tech) => (
            <TechTag>{tech}</TechTag>
          ))}
        </div>
      </div>
    </div>
  </div>
</div>


